<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>The Secret Helper Website</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="config.js"></script>
  <style>
    html, body {
      display: flex;
      flex-direction: column;
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background-color: #41586C;
      color: rgb(0,150,255);
    }
    #layout {
      margin: 0;
      padding: 0;
      width: 100%;
      flex-grow: 1;
      display: flex;
      background-color: #41586C;
      font-family: sans-serif;
      color: rgb(0,150,255);
    }
    #sidebar {
      width: 300px;
      max-height: 100%;
      padding: 20px;
      background-color: #2f3a4b;
      display: flex;
      flex-direction: column;
      gap: 15px;
      overflow-y: hidden;
      box-sizing: border-box;
    }
#sidebar label,
#sidebar button {
  display: flex;
  align-items: center;          /* vertically center text/inputs */
  justify-content: center;
  gap: 5px;                     /* space between label and slider */
  background: rgba(255,255,255,0.1);
  padding: 5px;
  margin: 5px;
  border-radius: 4px;
  color: #9dee33;
}

input[type=range] {
  -webkit-appearance: none; /* Remove default */
  appearance: none;
  width: 150px;
  height: 6px;
  background: #333;  /* Fallback track color before styling */
  border-radius: 3px;
}

/* Track for Chrome/Edge/Safari */
input[type=range]::-webkit-slider-runnable-track {
  height: 6px;
  background: linear-gradient(to left, rgb(0,150,255), rgb(0,80,150));
  border-radius: 3px;
}

/* Thumb for Chrome/Edge/Safari */
input[type=range]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  height: 16px;
  width: 16px;
  background: white;
  border-radius: 50%;
  border: 2px solid rgb(0,150,255);
  cursor: pointer;
  margin-top: -5px; /* Centers thumb on track */
}
    #imageContainer {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: relative;
      cursor: grab;
      border: 5px solid black;
      border-top: none;
    }

    #image {
      max-width: 100%;
      max-height: 100%;
      pointer-events: none;
      transition: transform 0.2s ease;
    }
    #imageTools {
      display: grid;
      grid-template-columns: 1fr 1fr;
    }

    label {
      display: flex;
      flex-direction: column;
      gap: 5px;
      text-align: center;
      color: #9DEE33;
    }

    input[type="range"], select, button {
      width: 100%;
    }
  header {
     display: flex;
     position: relative;
     justify-content: center;
     background-color: #2f3a4b;
     border-bottom: 5px solid black;
}
nav {
  display: flex;
  justify-content: space-around;
  text-align: center;
  padding: 10px;
  width:60vw;
}

nav a {
  text-decoration: none;
  color: white;
  width: 10vw;
  background-color: black;
  padding: 10px;
  border-radius: 10px;
}

nav a:hover {
   background-color: white;
   color: black;
   transition: .5s ease-in-out;
}
    #notes {
       display: flex;
       flex-direction: column;
       width: 20vw;
       height: 100%;
       background-color: #2f3a4b;
    }
    #notesEditor {
      width: 100%;
      height: 100%;
      min-height: 300px;
      resize: vertical;
      border: none;
      outline: none;
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }
    #notesEditor:focus {
      outline: 1px solid rgb(0,150,255);
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <a href="index.html">Map Helper</a>
      <a href="imageViewer.html">Image Viewer</a>
    </nav>
  </header>

<div id='layout'>
<div id="sidebar">
  <label>
    Select Image:
    <select id="imageSelect">
 <option value="">-- Choose --</option>
        <option value="overlay1.png">Image 1</option>
        <option value="overlay2.png">Image 2</option>
        <option value="overlay3.png">Image 3</option>
        <option value="overlay4.png">Image 4</option>
        <option value="overlay5.png">Image 5</option>
        <option value="overlay6.png">Image 6</option>
        <option value="overlay7.png">Image 7</option>
        <option value="overlay8.png">Image 8</option>
        <option value="overlay9.png">Image 9</option>
        <option value="overlay10.png">Image 10</option>
        <option value="overlay11.png">Image 11</option>
        <option value="overlay12.png">Image 12</option>
    </select>
  </label>
<div id = 'imageTools'>
  <label>
    Opacity:
    <input type="range" id="opacitySlider" min="0" max="1" step="0.05" value="1">
  </label>

  <label>
    Rotation:
    <input type="range" id="rotationSlider" min="0" max="360" step="1" value="0">
  </label>


  <label>
    Brightness:
    <input type="range" id="brightnessSlider" min="0" max="200" step="1" value="100">
  </label>

  <label>
    Contrast:
    <input type="range" id="contrastSlider" min="0" max="200" step="1" value="100">
  </label>

  <label>
    Saturation:
    <input type="range" id="saturationSlider" min="0" max="200" step="1" value="100">
  </label>

      <label>
        Hue Rotate:
        <input type="range" id="hueRotateSlider" min="0" max="360" step="1" value="0">
      </label>

      <label>
        Sepia:
        <input type="range" id="sepiaSlider" min="0" max="100" step="1" value="0">
      </label>

      <label>
        Invert:
        <input type="range" id="invertSlider" min="0" max="100" step="1" value="0">
      </label>

  <button id="flipButton">Flip Horizontal</button>
  <button id="resetImage">Reset Image</button>
</div>
  <label>
    Select Verse:
    <select id="verseSelect">
 <option value="">-- Choose --</option>
        <option value="verse1">Verse  1</option>
        <option value="verse2">Verse 2</option>
        <option value="verse3">Verse 3</option>
        <option value="verse4">Verse 4</option>
        <option value="verse5">Verse 5</option>
        <option value="verse6">Verse 6</option>
        <option value="verse7">Verse 7</option>
        <option value="verse8">Verse 8</option>
        <option value="verse9">Verse 9</option>
        <option value="verse10">Verse 10</option>
        <option value="verse11">Verse 11</option>
        <option value="verse12">Verse 12</option>
    </select>
  </label>

<div id = 'verseOutput'></div>
 
</div>

<div id="imageContainer">
  <img id="image" src="" alt="Select an image">
</div>

<div id= 'notes'>
      <label style="grid-column: 1 / -1;">
        Notes:
        <textarea id="notesEditor" placeholder="Enter notes for the selected image..."></textarea>
      </label>
 </div>
    </div>
</div>
<script>  

// Your web app's Firebase configuration
firebase.initializeApp(window.firebaseConfig);
const db = firebase.firestore();

const image = document.getElementById('image');
const container = document.getElementById('imageContainer');
let rotation = 0, flipped = false, scale = 1;
let imgPos = {x:0, y:0}, isDragging = false, dragStart = {x:0, y:0};

// Load image
document.getElementById('imageSelect').addEventListener('change', function() {
  const imgFile = this.value;
  if (imgFile) image.src = imgFile;
});
const notesEditor = document.getElementById('notesEditor');
let currentImage = '';

// Load notes from Firestore
function loadNotes(imageFile) {
  notesEditor.value = '';
  db.collection('notes').doc('shared').get().then(doc => {
    const notes = doc.exists ? doc.data() : {};
    notesEditor.value = notes[imageFile] || '';
  }).catch(e => {
    console.error('Error loading notes from Firestore:', e);
    notesEditor.value = 'Error loading notes from Firestore.';
  });
}

// Save notes to Firestore
function saveNotes(imageFile) {
  if (!imageFile) return;
  db.collection('notes').doc('shared').set({
    [imageFile]: notesEditor.value
  }, { merge: true }).catch(e => {
    console.error('Error saving notes to Firestore:', e);
    alert('Failed to save notes to Firestore.');
  });
}

// Real-time listener for Firestore updates
function setupRealtimeListener() {
  db.collection('notes').doc('shared').onSnapshot(doc => {
    if (doc.exists && currentImage) {
      const notes = doc.data();
      if (notes[currentImage] !== notesEditor.value) {
        notesEditor.value = notes[currentImage] || '';
      }
    }
  }, e => {
    console.error('Error in real-time listener:', e);
  });
}

// Initialize listener
setupRealtimeListener();
    imageSelect.addEventListener('change', function() {
      const imgFile = this.value;
      if (imgFile) {
        // Save notes for the previous image
        saveNotes(currentImage);
        // Update current image and load new image and notes
        currentImage = imgFile;
        image.src = imgFile;
        loadNotes(imgFile);
      } else {
        // Clear image and notes if no image is selected
        saveNotes(currentImage);
        currentImage = '';
        image.src = '';
        notesEditor.value = '';
      }
    });

    // Save notes on input
    notesEditor.addEventListener('input', () => {
      saveNotes(currentImage);
    });
// Load verse
const verses = {
  'verse1': `Fortress north
Cold as glass
Friendship south
Take your task
To the number
Nine eight two
Through the wood
No lion fears
In the sky the water veers
Small of scale
Step across
Perspective should not be lost
In the center of four alike
Small, split,
Three winged and slight
What we take to be
Our strongest tower of delight
Falls gently
In December night
Looking back from treasure ground
There's the spout!
A whistle sounds.`,

  'verse2': `At the place where jewels abound
Fifteen rows down to the ground
In the middle of twenty-one
From end to end
Only three stand watch
As the sound of friends
Fills the afternoon hours
Here is a sovereign people
Who build palaces to shelter
Their heads for a night!
Gnomes admire
Fays delight
The namesakes meeting
Near this site.`,

  'verse3': `If Thucydides is
North of Xenophon
Take five steps
In the area of his direction
A green tower of lights
In the middle section
Near those
Who pass the coliseum
With metal walls
Face the water
Your back to the stairs
Feel at home
All the letters
Are here to see
Eighteenth day
Twelfth hour
Lit by lamplight
In truth, be free.`,

  'verse4': `Beneath two countries
As the road curves
In a rectangular plot
Beneath the tenth stone
From right to left
Beneath the ninth row from the top
Of the wall including small bricks
Seven steps up you can hop
From the bottom level
Socrates, Pindar, Apelles
Free speech, couplet, birch
To find casque's destination
Seek the columns
For the search.`,

  'verse5': `Lane
Two twenty two
You'll see an arc of lights
Weight and roots extended
Together saved the site
Of granite walls
Wind swept halls
Citadel in the night
A wingless bird ascended
Born of ancient dreams of flight
Beneath the only standing member
Of a forest
To the south
White stone closest
At twelve paces
From the west side
Get permission
To dig out.`,

  'verse6': `Of all the romance retold
Men of tales and tunes
Cruel and bold
Seen here
By eyes of old
Stand and listen to the birds
Hear the cool, clear song of water
Harken to the words:
Freedom at the birth of a century
Or May 1913
Edwin and Edwina named after him
Or on the eighth a scene
Where law defended
Between two arms extended
Below the bar that binds
Beside the long palm's shadow
Embedded in the sand
Waits the Fair remuneration
White house close at hand.`,

  'verse7': `At stone wall's door
The air smells sweet
Not far away
High posts are three
Education and Justice
For all to see
Sounds from the sky
Near ace is high
Running north, but first across
In jewel's direction
Is an object
Of Twain's attention
Giant pole
Giant step
To the place
The casque is kept.`,

  'verse8': `View the three stories of Mitchell
As you walk the beating of the world
At a distance in time
From three who lived there
At a distance in space
From woman, with harpsichord
Silently playing
Step on nature
Cast in copper
Ascend the 92 steps
After climbing the grand 200
Pass the compass and reach
The foot of the culvert
Below the bridge
Walk 100 paces
Southeast over rock and soil
To the first young birch
Pass three, staying west
You'll see a letter from the country
Of wonderstone's hearth
On a proud, tall fifth
At its southern foot
The treasure waits.`,

  'verse9': `The first chapter
Written in water
Near men
With wind rose
Behind bending branches
And a green picket fence
At the base of a tall tree
You can still hear the honking
Shell, limestone, silver, salt
Stars move by day
Sails pass by night
Even in darkness
Like moonlight in teardrops
Over the tall grass
Years pass, rain falls.`,

  'verse10': `In the shadow
Of the grey giant
Find the arm that
Extends over the slender path
In summer
You'll often hear a whirring sound
Cars abound
Although the sign
Nearby
Speaks of Indies native
The natives still speak
Of him of Hard word in 3 Vols.
Take twice as many east steps as the hour
Or more
From the middle of one branch
Of the v
Look down
And see simple roots
In rhapsodic man's soil
Or gaze north
Toward the isle of B.`,

  'verse11': `Pass two friends of octave
In December
Ride the man of oz
To the land near the window
There's a road that leads to
Dark forest
Where white is in color
With two maps
After circle and square
In July and August
A path beckons
To mica and driftwood
Under that
Which may be last touched
Or first seen standing
Look north at the wing
And dig
To achieve
By dauntless and inconquerable
Determination
Your goal.`,

  'verse12': `Where M and B are set in stone
And to Congress, R is known
L sits and left
Beyond his shoulder
Is the Fair Folks'
Treasure holder
The end of ten by thirteen
Is your clue
Fence and fixture
Central too
For finding jewel casque
Seek the sounds
Of rumble
Brush and music
Hush.`,
};

const verseSelect = document.getElementById('verseSelect');
const output = document.getElementById('verseOutput');

verseSelect.addEventListener('change', () => {
  const key = verseSelect.value;
  if (!key) {
    output.textContent = "Your verse will appear here...";
    return;
  }
const verseText = verses[key] || "Verse not found.";
  output.innerHTML = verseText.replace(/\n/g, '<br>')
});
// Filters
function applyFilters() {
  const brightness = document.getElementById('brightnessSlider').value;
  const contrast = document.getElementById('contrastSlider').value;
  const saturation = document.getElementById('saturationSlider').value;
  const hueRotate = document.getElementById('hueRotateSlider').value;
  const sepia = document.getElementById('sepiaSlider').value;
  const invert = document.getElementById('invertSlider').value;
      image.style.filter = `
        brightness(${brightness}%)
        contrast(${contrast}%)
        saturate(${saturation}%)
        hue-rotate(${hueRotate}deg)
        sepia(${sepia}%)
        invert(${invert}%)
        drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.5))
      `;
}
    ['brightnessSlider', 'contrastSlider', 'saturationSlider', 'hueRotateSlider', 'sepiaSlider', 'invertSlider'].forEach(id => {
      document.getElementById(id).addEventListener('input', applyFilters);
    });
// Rotation & flip
document.getElementById('rotationSlider').addEventListener('input', function() {
  rotation = this.value;
  updateTransform();
});
document.getElementById('flipButton').addEventListener('click', function() {
  flipped = !flipped;
  updateTransform();
});
document.getElementById('opacitySlider').addEventListener('input', function() {
  image.style.opacity = this.value;
});

function updateTransform() {
  image.style.transform = `translate(${imgPos.x}px, ${imgPos.y}px) scale(${scale}) rotate(${rotation}deg) scaleX(${flipped?-1:1})`;
}

// Zoom
container.addEventListener('wheel', e => {
  e.preventDefault();
  const zoomAmount = e.deltaY < 0 ? 0.1 : -0.1;
  scale = Math.max(scale + zoomAmount, 0.1);
  updateTransform();
});

// Drag
container.addEventListener('mousedown', e => {
  e.preventDefault();
  isDragging = true;
  dragStart.x = e.clientX - imgPos.x;
  dragStart.y = e.clientY - imgPos.y;
  container.style.cursor = 'grabbing';
});
window.addEventListener('mousemove', e => {
  if(!isDragging) return;
  imgPos.x = e.clientX - dragStart.x;
  imgPos.y = e.clientY - dragStart.y;
  updateTransform();
});
window.addEventListener('mouseup', () => {
  isDragging = false;
  container.style.cursor = 'grab';
});

// Reset
document.getElementById('resetImage').addEventListener('click', () => {
  rotation = 0; flipped = false; scale = 1; imgPos = {x:0,y:0};
  document.getElementById('rotationSlider').value = 0;
  document.getElementById('opacitySlider').value = 1;
  document.getElementById('brightnessSlider').value = 100;
  document.getElementById('contrastSlider').value = 100;
  document.getElementById('saturationSlider').value = 100;
  document.getElementById('sepiaSlider').value = 0;
  document.getElementById('invertSlider').value = 0;
  document.getElementById('hueRotateSlider').value = 0;
  image.style.opacity = 1;
  applyFilters();
  updateTransform();
});
</script>

</body>
</html>
